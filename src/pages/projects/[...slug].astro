---
import TagLinks from "@components/TagLinks.astro";
import Layout, { type Meta } from "@layouts/Layout.astro";
import { getBreadcrumbs, getTags, toISODate } from "@lib/util";
import type { GetStaticPaths } from "astro";
import { getCollection, render } from "astro:content";

export const getStaticPaths = (async () => {
	const projects = await getCollection("projects");

	return projects.map((projectPage) => ({
		params: { slug: projectPage.id },
		props: { projectPage },
	}));
}) satisfies GetStaticPaths;

const { projectPage } = Astro.props;
const { Content } = await render(projectPage);

const tags = await getTags(projectPage);

const meta: Meta = {
	date: toISODate(projectPage.data.date),
	description: projectPage.data.description,
	section: "projects",
	tags: tags.map((t) => t.data.name),
};

const ld = getBreadcrumbs([
	["projects", new URL("projects", Astro.site)],
	[projectPage.data.title, undefined],
]);
---

<Layout title={projectPage.data.title} ld={ld} meta={meta}>
	<section>
		<a href="/projects" title="back to projects"><strong>projects</strong>/</a>
		<h1>{ projectPage.data.title } { projectPage.data.link ? <a class="button" href={projectPage.data.link.url}>{ projectPage.data.link.name }</a> : undefined }</h1>
		<p><TagLinks tags={tags} /></p>

		<Content />
	</section>
</Layout>

<style>
	body {
		--theme: var(--projects);
	}

	iframe {
		border: none;
	}

	h1 .button {
		font-size: 1.25rem;
		margin-left: .5em;
	}
</style>
